<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WantToWin - Premium Products for Winners</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Montserrat', sans-serif;
            overflow-x: hidden;
            background-color: #000;
            color: #fff;
        }
        
        .active-tab {
            color: #ef4444;
        }
        
        .nav-link {
            position: relative;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: white;
            transition: width 0.3s;
        }
        
        .nav-link:hover::after {
            width: 100%;
        }
        
        .shop-item {
            transition: all 0.3s ease;
        }
        
        .shop-item:hover {
            transform: translateY(-5px);
        }
        
        .chat-message {
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 12px;
            margin-bottom: 10px;
        }
        
        .user-message {
            background-color: #ef4444;
            margin-left: auto;
        }
        
        .admin-message {
            background-color: #374151;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="py-6 px-4 md:px-12 flex justify-between items-center border-b border-gray-800 sticky top-0 bg-black z-40">
        <div class="flex items-center">
            <a href="#shop" class="text-2xl font-bold tracking-tight">
                <span class="text-red-500">WantToWin</span>
            </a>
        </div>
        
        <div class="hidden md:flex space-x-8 items-center">
            <a href="#shop" id="shop-tab" class="nav-link text-white font-medium active-tab">Shop</a>
            <a href="#contact" id="contact-tab" class="nav-link text-white font-medium">Contact</a>
            <a href="#information" id="information-tab" class="nav-link text-white font-medium">Information</a>
            <a href="#login" id="login-tab" class="nav-link text-white font-medium">Login</a>
            <a href="#cart" id="cart-tab" class="nav-link text-white font-medium">Cart</a>
        </div>

        <div id="user-info" class="hidden items-center space-x-4">
            <span id="user-email" class="text-white text-sm"></span>
            <button id="logout-btn" class="text-red-500 hover:text-red-400 font-medium text-sm">Logout</button>
        </div>

        <div class="flex items-center space-x-4">
            <button class="md:hidden text-white" id="mobile-menu-btn">
                <i data-feather="menu"></i>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden md:hidden bg-gray-900 py-2 px-4 border-b border-gray-800">
        <a href="#shop" class="block py-2 text-white">Shop</a>
        <a href="#contact" class="block py-2 text-white">Contact</a>
        <a href="#information" class="block py-2 text-white">Information</a>
        <a href="#login" id="mobile-login" class="block py-2 text-white">Login</a>
        <div id="mobile-user-info" class="hidden">
            <span id="mobile-user-email" class="block py-2 text-white"></span>
            <button id="mobile-logout" class="block py-2 text-red-500 w-full text-left">Logout</button>
        </div>
        <a href="#cart" class="block py-2 text-white">Cart</a>
    </div>

    <!-- Shop Section -->
    <section id="shop" class="tab-section py-16 px-4 md:px-12 fade-in">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-4xl font-bold mb-12 text-center">Premium Products</h1>
            
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Product 1 -->
                <div class="shop-item bg-gray-900 rounded-lg overflow-hidden shadow-lg">
                    <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" 
                         alt="Premium Shoes" 
                         class="w-full h-48 object-cover"
                         loading="lazy">
                    <div class="p-6">
                        <h3 class="text-xl font-bold mb-2">Premium Shoes</h3>
                        <p class="text-gray-400 mb-4">High-quality premium shoes for winners</p>
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-medium">₪100</span>
                            <button class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-medium add-to-cart" 
                                    data-id="1"
                                    data-name="Premium Shoes" 
                                    data-price="100" 
                                    data-image="https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Product 2 -->
                <div class="shop-item bg-gray-900 rounded-lg overflow-hidden shadow-lg">
                    <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" 
                         alt="Luxury Watch" 
                         class="w-full h-48 object-cover"
                         loading="lazy">
                    <div class="p-6">
                        <h3 class="text-xl font-bold mb-2">Luxury Watch</h3>
                        <p class="text-gray-400 mb-4">Elegant timepiece for successful people</p>
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-medium">₪1000</span>
                            <button class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-medium add-to-cart" 
                                    data-id="2"
                                    data-name="Luxury Watch" 
                                    data-price="1000" 
                                    data-image="https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Product 3 -->
                <div class="shop-item bg-gray-900 rounded-lg overflow-hidden shadow-lg">
                    <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" 
                         alt="Wireless Headphones" 
                         class="w-full h-48 object-cover"
                         loading="lazy">
                    <div class="p-6">
                        <h3 class="text-xl font-bold mb-2">Wireless Headphones</h3>
                        <p class="text-gray-400 mb-4">Premium sound quality for immersive experience</p>
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-medium">₪200</span>
                            <button class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-medium add-to-cart" 
                                    data-id="3"
                                    data-name="Wireless Headphones" 
                                    data-price="200" 
                                    data-image="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="tab-section hidden py-16 px-4 md:px-12 bg-gray-900 fade-in">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold mb-12 text-center">Contact Us</h2>
            <div class="grid md:grid-cols-2 gap-12">
                <div>
                    <h3 class="text-xl font-bold mb-4">Send us a message</h3>
                    <form id="contact-form" class="space-y-4">
                        <div>
                            <input type="text" id="contact-name" placeholder="Your Name" 
                                   class="w-full bg-gray-800 text-white p-3 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                                   minlength="2" maxlength="50" required>
                        </div>
                        <div>
                            <input type="email" id="contact-email" placeholder="Your Email" 
                                   class="w-full bg-gray-800 text-white p-3 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                                   required>
                        </div>
                        <div>
                            <textarea id="contact-message" placeholder="Your Message" rows="5" 
                                      class="w-full bg-gray-800 text-white p-3 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                                      minlength="10" maxlength="500" required></textarea>
                        </div>
                        <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded font-medium transition">
                            Send Message
                        </button>
                    </form>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Contact Information</h3>
                    <div class="space-y-6">
                        <div class="flex items-start">
                            <i data-feather="mail" class="text-red-500 mr-4 mt-1"></i>
                            <div>
                                <h4 class="font-medium">Email</h4>
                                <p class="text-gray-400">bezalelganam95@gmail.com</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <i data-feather="phone" class="text-red-500 mr-4 mt-1"></i>
                            <div>
                                <h4 class="font-medium">Phone</h4>
                                <p class="text-gray-400">+1 (555) 123-4567</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <i data-feather="map-pin" class="text-red-500 mr-4 mt-1"></i>
                            <div>
                                <h4 class="font-medium">Address</h4>
                                <p class="text-gray-400">123 Winner Street, Success City, SC 12345</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Information Section -->
    <section id="information" class="tab-section hidden py-16 px-4 md:px-12 fade-in">
        <div class="max-w-6xl mx-auto text-center">
            <h2 class="text-3xl md:text-4xl font-bold mb-6">WantToWin</h2>
            <p class="text-xl text-gray-400 max-w-3xl mx-auto mb-12">
                We are making the odds for you. Premium products for those who strive for success.
            </p>
            <div class="bg-gray-900 rounded-lg p-8 max-w-2xl mx-auto">
                <div class="space-y-6">
                    <div class="flex items-start">
                        <i data-feather="mail" class="text-red-500 mr-4 mt-1"></i>
                        <div class="text-left">
                            <h4 class="font-medium">Email</h4>
                            <p class="text-gray-400">bezalelganam95@gmail.com</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i data-feather="phone" class="text-red-500 mr-4 mt-1"></i>
                        <div class="text-left">
                            <h4 class="font-medium">Phone</h4>
                            <p class="text-gray-400">+1 (555) 123-4567</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i data-feather="clock" class="text-red-500 mr-4 mt-1"></i>
                        <div class="text-left">
                            <h4 class="font-medium">Business Hours</h4>
                            <p class="text-gray-400">Monday - Friday: 9:00 AM - 6:00 PM</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Login Section -->
    <section id="login" class="tab-section hidden py-16 px-4 md:px-12 bg-gray-900 fade-in">
        <div class="max-w-md mx-auto bg-black rounded-lg p-8 shadow-lg">
            <h1 class="text-3xl font-bold mb-8 text-center">Login</h1>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="email" class="block text-gray-400 mb-2">Email</label>
                    <input type="email" id="email" 
                           class="w-full bg-gray-800 text-white p-3 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                           required>
                </div>
                <div>
                    <label for="password" class="block text-gray-400 mb-2">Password</label>
                    <input type="password" id="password" 
                           class="w-full bg-gray-800 text-white p-3 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                           minlength="6" required>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="checkbox" id="remember" class="mr-2">
                        <label for="remember" class="text-gray-400">Remember me</label>
                    </div>
                    <a href="#forgot-password" class="text-red-500 hover:text-red-400 text-sm forgot-password">Forgot password?</a>
                </div>
                <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded font-medium transition">
                    Sign In
                </button>
            </form>
            <div class="mt-6 text-center">
                <p class="text-gray-400">Don't have an account? <a href="#signup" class="text-red-500 hover:text-red-400 signup-link">Sign up</a></p>
            </div>
        </div>
    </section>

    <!-- Forgot Password Section -->
    <section id="forgot-password" class="tab-section hidden py-16 px-4 md:px-12 bg-gray-900 fade-in">
        <div class="max-w-md mx-auto bg-black rounded-lg p-8 shadow-lg">
            <h1 class="text-3xl font-bold mb-8 text-center">Reset Password</h1>
            <form id="forgot-password-form" class="space-y-6">
                <div>
                    <label for="reset-email" class="block text-gray-400 mb-2">Email</label>
                    <input type="email" id="reset-email" 
                           class="w-full bg-gray-800 text-white p-3 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                           required>
                </div>
                <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded font-medium transition">
                    Send Reset Link
                </button>
            </form>
            <div class="mt-6 text-center">
                <p class="text-gray-400">Remember your password? <a href="#login" class="text-red-500 hover:text-red-400 back-to-login">Back to Login</a></p>
            </div>
        </div>
    </section>

    <!-- Signup Section -->
    <section id="signup" class="tab-section hidden py-16 px-4 md:px-12 bg-gray-900 fade-in">
        <div class="max-w-md mx-auto bg-black rounded-lg p-8 shadow-lg">
            <h1 class="text-3xl font-bold mb-8 text-center">Create Account</h1>
            
            <form id="signup-form" class="space-y-6">
                <div>
                    <label for="name" class="block text-gray-400 mb-2">Full Name</label>
                    <input type="text" id="name" 
                           class="w-full bg-gray-800 text-white p-3 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                           minlength="2" maxlength="50" required>
                </div>
                <div>
                    <label for="signup-email" class="block text-gray-400 mb-2">Email</label>
                    <input type="email" id="signup-email" 
                           class="w-full bg-gray-800 text-white p-3 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                           required>
                </div>
                <div>
                    <label for="signup-password" class="block text-gray-400 mb-2">Password</label>
                    <input type="password" id="signup-password" 
                           class="w-full bg-gray-800 text-white p-3 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                           minlength="6" required>
                </div>
                <div>
                    <label for="confirm-password" class="block text-gray-400 mb-2">Confirm Password</label>
                    <input type="password" id="confirm-password" 
                           class="w-full bg-gray-800 text-white p-3 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                           minlength="6" required>
                </div>
                <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded font-medium transition">
                    Create Account
                </button>
            </form>
            <div class="mt-6 text-center">
                <p class="text-gray-400">Already have an account? <a href="#login" class="text-red-500 hover:text-red-400 back-to-login">Login</a></p>
            </div>
        </div>
    </section>

    <!-- Cart Section -->
    <section id="cart" class="tab-section hidden py-16 px-4 md:px-12 fade-in">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-3xl md:text-4xl font-bold mb-8">Your Cart</h1>
            
            <div id="cart-items" class="mb-8">
                <div id="empty-cart-message" class="text-center py-12">
                    <i data-feather="shopping-cart" class="w-12 h-12 mx-auto text-gray-500 mb-4"></i>
                    <p class="text-xl text-gray-400">Your cart is empty</p>
                    <a href="#shop" class="text-red-500 hover:text-red-400 mt-4 inline-block">Start Shopping</a>
                </div>
            </div>

            <div class="bg-gray-900 rounded-lg p-6">
                <div class="flex justify-between mb-4">
                    <span class="text-gray-400">Subtotal</span>
                    <span id="subtotal" class="font-medium">₪0</span>
                </div>
                <div class="flex justify-between mb-4">
                    <span class="text-gray-400">Shipping</span>
                    <span class="font-medium">Free</span>
                </div>
                <div class="flex justify-between mb-6 border-t border-gray-800 pt-4">
                    <span class="text-lg">Total</span>
                    <span id="total" class="text-xl font-bold">₪0</span>
                </div>
                <button id="checkout-btn" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded font-medium transition">
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </section>

    <!-- Order Confirmation Section -->
    <section id="order-confirmation" class="tab-section hidden py-16 px-4 md:px-12 bg-gray-900 fade-in">
        <div class="max-w-2xl mx-auto text-center">
            <div class="bg-black rounded-lg p-8">
                <i data-feather="check-circle" class="w-16 h-16 mx-auto text-green-500 mb-4"></i>
                <h1 class="text-3xl font-bold mb-4">Order Confirmed!</h1>
                <p class="text-gray-400 mb-6">Thank you for your purchase. We've sent a confirmation email.</p>
                <div id="order-details" class="mb-6 text-left bg-gray-800 p-4 rounded">
                    <!-- Order details will be populated here -->
                </div>
                <a href="#shop" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded font-medium transition">
                    Continue Shopping
                </a>
            </div>
        </div>
    </section>

    <!-- Admin Chat Button -->
    <button id="admin-chat-btn" class="fixed bottom-6 right-6 bg-red-500 text-white p-4 rounded-full shadow-lg hover:bg-red-600 transition z-30">
        <i data-feather="message-circle"></i>
    </button>

    <!-- Admin Chat Modal -->
    <div id="admin-chat-modal" class="fixed bottom-24 right-6 w-80 bg-gray-900 rounded-lg shadow-xl border border-gray-700 hidden z-40">
        <div class="p-4 border-b border-gray-700 flex justify-between items-center">
            <h3 class="font-bold">Chat Support</h3>
            <button id="close-chat" class="text-gray-400 hover:text-white">
                <i data-feather="x"></i>
            </button>
        </div>
        <div id="chat-messages" class="p-4 h-64 overflow-y-auto">
            <div class="chat-message admin-message">
                Welcome! How can we help you today?
            </div>
        </div>
        <div class="p-4 border-t border-gray-700">
            <input type="text" id="chat-input" 
                   class="w-full bg-gray-800 text-white p-2 rounded focus:outline-none focus:ring-2 focus:ring-red-500" 
                   placeholder="Type a message..." maxlength="200">
        </div>
    </div>

    <script>
        // EmailJS Configuration - YOUR KEYS
        emailjs.init('AefX1sL9Wjlv6CXnz');
        const EMAILJS_SERVICE_ID = 'service_76p23kb';
        const EMAILJS_TEMPLATE_ID = 'template_l3l7so9';

        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded - initializing app');
            feather.replace();
            
            // Initialize data
            if (!localStorage.getItem('cart')) {
                localStorage.setItem('cart', JSON.stringify([]));
            }
            if (!localStorage.getItem('users')) {
                localStorage.setItem('users', JSON.stringify([]));
            }
            if (!localStorage.getItem('orders')) {
                localStorage.setItem('orders', JSON.stringify([]));
            }
            
            // Setup everything
            setupNavigation();
            setupAddToCartListeners();
            setupFormHandlers();
            setupChat();
            updateCartBadge();
            updateNavigation();
            
            // Handle initial page
            if (!window.location.hash || window.location.hash === '#') {
                window.location.hash = 'shop';
            } else {
                handleHashChange();
            }
        });

        // NAVIGATION FUNCTIONS
        function setupNavigation() {
            // Tab clicks
            document.querySelectorAll('[id$="-tab"]').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = tab.id.replace('-tab', '');
                    window.location.hash = sectionId;
                });
            });
            
            // Mobile menu
            document.getElementById('mobile-menu-btn').addEventListener('click', () => {
                document.getElementById('mobile-menu').classList.toggle('hidden');
                feather.replace();
            });
            
            // Hash changes
            window.addEventListener('hashchange', handleHashChange);
        }

        function handleHashChange() {
            const hash = window.location.hash.substring(1) || 'shop';
            console.log('Showing section:', hash);
            
            // Hide all sections
            document.querySelectorAll('.tab-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show target section
            const targetSection = document.getElementById(hash);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Update active tab
            document.querySelectorAll('[id$="-tab"]').forEach(tab => {
                tab.classList.remove('active-tab');
            });
            
            const activeTab = document.getElementById(hash + '-tab');
            if (activeTab) activeTab.classList.add('active-tab');
            
            // Close mobile menu after navigation
            document.getElementById('mobile-menu').classList.add('hidden');
            
           // Section-specific setup
          if (hash === 'cart') {
            renderCart(); // ✅ FIXED: Remove setTimeout, call directly
           }
          if (hash === 'shop') {
            setupAddToCartListeners(); // ✅ FIXED: Remove setTimeout, call directly
            }
        }

        // FORM HANDLERS
        function setupFormHandlers() {
            // Contact form
            document.getElementById('contact-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleContactForm();
            });

            // Login form
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });

            // Signup form - FIXED: Proper event listener
            const signupForm = document.getElementById('signup-form');
            signupForm.addEventListener('submit', function(e) {
                e.preventDefault();
                handleSignup();
            });

            // Forgot password form
            document.getElementById('forgot-password-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleForgotPassword();
            });

            // Navigation links
            document.querySelectorAll('.forgot-password').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.hash = 'forgot-password';
                });
            });

            document.querySelectorAll('.signup-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.hash = 'signup';
                });
            });

            document.querySelectorAll('.back-to-login').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.hash = 'login';
                });
            });

            // Checkout button
            document.getElementById('checkout-btn').addEventListener('click', handleCheckout);

            // Logout buttons
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            document.getElementById('mobile-logout').addEventListener('click', handleLogout);
        }

        // CONTACT FORM
        function handleContactForm() {
            const name = document.getElementById('contact-name').value.trim();
            const email = document.getElementById('contact-email').value.trim();
            const message = document.getElementById('contact-message').value.trim();

            const emailData = {
                to_email: 'bezalelganam95@gmail.com',
                from_name: name,
                from_email: email,
                message: message,
                subject: `New Contact Form Message from ${name}`
            };

            emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, emailData)
                .then(function(response) {
                    console.log('SUCCESS!', response.status, response.text);
                    alert('Thank you for your message! We will get back to you soon.');
                    document.getElementById('contact-form').reset();
                }, function(error) {
                    console.log('FAILED...', error);
                    alert('There was an error sending your message. Please try again later.');
                });
        }

        // AUTHENTICATION FUNCTIONS
        function handleLogin() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(user => user.email === email && user.password === password);

            if (user) {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userEmail', email);
                localStorage.setItem('userName', user.name || email.split('@')[0]);
                
                updateNavigation();
                alert('Login successful!');
                window.location.hash = 'shop';
            } else {
                alert('Invalid email or password. Please try again or sign up.');
            }
        }

        function handleSignup() {
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            // Validate passwords match
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            // Get existing users
            const users = JSON.parse(localStorage.getItem('users')) || [];

            // Check if user already exists
            if (users.some(user => user.email === email)) {
                alert('This email is already registered!');
                return;
            }

            // Add new user
            users.push({
                name: name,
                email: email,
                password: password
            });

            // Save to localStorage
            localStorage.setItem('users', JSON.stringify(users));

            // Clear form
            document.getElementById('signup-form').reset();

            // Redirect to login
            alert('Account created successfully! Please login.');
            window.location.hash = 'login';
        }

      function handleForgotPassword() {
    const email = document.getElementById('reset-email').value.trim();
    
    // Get existing users
    const users = JSON.parse(localStorage.getItem('users')) || [];
    
    // Check if user exists
    const userExists = users.some(user => user.email === email);
    
    if (userExists) {
        // Generate a simple token (in real app, use proper JWT or crypto)
        const token = Date.now().toString(36) + Math.random().toString(36).substr(2);
        
        // Store reset token temporarily (in real app, use database)
        localStorage.setItem('resetToken_' + email, token);
        
        // Create reset link
        const resetLink = `reset-password.html?token=${token}&email=${encodeURIComponent(email)}`;
        
        // Create email data for password reset
        const resetEmailData = {
            to_email: email,
            from_name: 'WantToWin Support',
            from_email: 'bezalelganam95@gmail.com',
            subject: 'Password Reset Request - WantToWin',
            message: `You requested a password reset. Please click the link below to reset your password:\n\nReset Link: ${window.location.origin}/${resetLink}\n\nThis link will expire in 1 hour.\n\nIf you didn't request this, please ignore this email.`
        };
        
        // Send reset email using EmailJS
        emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, resetEmailData)
            .then(function(response) {
                console.log('SUCCESS!', response.status, response.text);
                alert('Password reset link has been sent to your email. Please check your inbox.');
                window.location.hash = 'login';
            }, function(error) {
                console.log('FAILED...', error);
                alert('There was an error sending the reset email. Please try again later.');
            });
    } else {
        alert('No account found with this email address.');
    }
}

        function updateNavigation() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const userEmail = localStorage.getItem('userEmail');

            // Desktop
            const loginTab = document.getElementById('login-tab');
            const userInfo = document.getElementById('user-info');
            const userEmailSpan = document.getElementById('user-email');

            // Mobile
            const mobileLogin = document.getElementById('mobile-login');
            const mobileUserInfo = document.getElementById('mobile-user-info');
            const mobileUserEmail = document.getElementById('mobile-user-email');

            if (isLoggedIn && userEmail) {
                loginTab.classList.add('hidden');
                userInfo.classList.remove('hidden');
                userInfo.classList.add('flex');
                userEmailSpan.textContent = userEmail;
                
                mobileLogin.classList.add('hidden');
                mobileUserInfo.classList.remove('hidden');
                mobileUserEmail.textContent = userEmail;
            } else {
                loginTab.classList.remove('hidden');
                userInfo.classList.add('hidden');
                userInfo.classList.remove('flex');
                
                mobileLogin.classList.remove('hidden');
                mobileUserInfo.classList.add('hidden');
            }
        }

        function handleLogout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userName');
            updateNavigation();
            alert('You have been logged out.');
            window.location.hash = 'shop';
        }

        // CART FUNCTIONS - FULLY FIXED
       function setupAddToCartListeners() {
    // Remove existing listeners first to prevent duplicates
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.replaceWith(button.cloneNode(true));
    });
    
    // Re-attach listeners to new buttons
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const product = {
                id: this.dataset.id,
                name: this.dataset.name,
                price: parseFloat(this.dataset.price),
                image: this.dataset.image
            };
            addToCart(product, this);
        });
    });
}

       function addToCart(product, button) {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    
    // Check if product already exists
    const existingIndex = cart.findIndex(item => item.id === product.id);
    
    if (existingIndex > -1) {
        // Increase quantity if exists
        cart[existingIndex].quantity = (cart[existingIndex].quantity || 1) + 1;
    } else {
        // Add new item with quantity
        product.quantity = 1;
        cart.push(product);
    }
    
    localStorage.setItem('cart', JSON.stringify(cart));
    
    // Visual feedback - FIXED: Use the correct button reference
    const originalText = button.textContent;
    button.textContent = '✓ Added';
    button.classList.add('bg-green-500', 'hover:bg-green-600');
    
    setTimeout(() => {
        button.textContent = 'Add to Cart'; // FIXED: Hardcode the text
        button.classList.remove('bg-green-500', 'hover:bg-green-600');
    }, 1500);

    // Update everything immediately
    updateCartBadge();
    
    // If on cart page, update cart display immediately
    if (window.location.hash === '#cart') {
        renderCart();
    }
}

        function renderCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartItemsEl = document.getElementById('cart-items');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const subtotalEl = document.getElementById('subtotal');
            const totalEl = document.getElementById('total');
            const checkoutBtn = document.getElementById('checkout-btn');

            // Clear current content
            cartItemsEl.innerHTML = '';
            
            if (cart.length === 0) {
                emptyCartMessage.classList.remove('hidden');
                subtotalEl.textContent = '₪0';
                totalEl.textContent = '₪0';
                checkoutBtn.disabled = true;
                checkoutBtn.classList.add('opacity-50', 'cursor-not-allowed');
                return;
            }

            emptyCartMessage.classList.add('hidden');
            checkoutBtn.disabled = false;
            checkoutBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            
            let subtotal = 0;
            
            cart.forEach((item, index) => {
                const quantity = item.quantity || 1;
                const itemTotal = item.price * quantity;
                subtotal += itemTotal;
                
                const itemHTML = `
                    <div class="flex items-center justify-between py-4 border-b border-gray-800 cart-item">
                        <div class="flex items-center space-x-4">
                            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded">
                            <div>
                                <h3 class="font-medium">${item.name}</h3>
                                <p class="text-gray-400">₪${item.price}</p>
                                <div class="flex items-center space-x-2 mt-2">
                                    <button class="quantity-btn text-gray-400 hover:text-white" data-index="${index}" data-action="decrease">-</button>
                                    <span class="quantity">${quantity}</span>
                                    <button class="quantity-btn text-gray-400 hover:text-white" data-index="${index}" data-action="increase">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="font-medium">₪${itemTotal.toFixed(2)}</span>
                            <button class="text-red-500 hover:text-red-400 remove-item" data-index="${index}">
                                <i data-feather="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                `;
                cartItemsEl.innerHTML += itemHTML;
            });

            subtotalEl.textContent = `₪${subtotal.toFixed(2)}`;
            totalEl.textContent = `₪${subtotal.toFixed(2)}`;
            
            // Re-attach event listeners
            setupCartEventListeners();
            feather.replace();
        }

        function setupCartEventListeners() {
            // Remove items
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    removeFromCart(index);
                });
            });

            // Quantity adjustments
            document.querySelectorAll('.quantity-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    const action = this.dataset.action;
                    adjustQuantity(index, action);
                });
            });
        }

      function removeFromCart(index) {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    if (index >= 0 && index < cart.length) {
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart(); // FIXED: This updates display immediately
        updateCartBadge();
    }
}

       function adjustQuantity(index, action) {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    if (index >= 0 && index < cart.length) {
        const item = cart[index];
        item.quantity = item.quantity || 1;
        
        if (action === 'increase') {
            item.quantity++;
        } else if (action === 'decrease' && item.quantity > 1) {
            item.quantity--;
        } else if (action === 'decrease' && item.quantity === 1) {
            // If quantity would be 0, remove item instead
            cart.splice(index, 1);
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart(); // FIXED: This will update the display immediately
        updateCartBadge();
    }
}

        function updateCartBadge() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartTab = document.getElementById('cart-tab');
            
            if (cartTab) {
                const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
                cartTab.textContent = totalItems > 0 ? `Cart (${totalItems})` : 'Cart';
            }
        }

        function handleCheckout() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }

            if (!isLoggedIn) {
                alert('Please login to complete your purchase.');
                window.location.hash = 'login';
                return;
            }

            // Create order
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const order = {
                id: Date.now(),
                userEmail: localStorage.getItem('userEmail'),
                items: [...cart],
                total: cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0),
                date: new Date().toLocaleString(),
                status: 'confirmed'
            };

            orders.push(order);
            localStorage.setItem('orders', JSON.stringify(orders));

            // Clear cart
            localStorage.setItem('cart', JSON.stringify([]));
            updateCartBadge();

            // Show order confirmation
            showOrderConfirmation(order);
        }

        function showOrderConfirmation(order) {
            const orderDetailsEl = document.getElementById('order-details');
            orderDetailsEl.innerHTML = `
                <p><strong>Order ID:</strong> #${order.id}</p>
                <p><strong>Date:</strong> ${order.date}</p>
                <p><strong>Total:</strong> ₪${order.total.toFixed(2)}</p>
                <p><strong>Items:</strong></p>
                <ul class="list-disc list-inside ml-4">
                    ${order.items.map(item => 
                        `<li>${item.name} x${item.quantity || 1} - ₪${(item.price * (item.quantity || 1)).toFixed(2)}</li>`
                    ).join('')}
                </ul>
            `;
            
            window.location.hash = 'order-confirmation';
        }

        // CHAT FUNCTIONALITY
        function setupChat() {
            document.getElementById('admin-chat-btn').addEventListener('click', toggleChat);
            document.getElementById('close-chat').addEventListener('click', toggleChat);
            
            document.getElementById('chat-input').addEventListener('keypress', function(e) {
                if(e.key === 'Enter' && e.target.value.trim()) {
                    const message = e.target.value.trim();
                    const chatMessages = document.getElementById('chat-messages');
                    
                    // Add user message
                    chatMessages.innerHTML += `
                        <div class="chat-message user-message">
                            ${message}
                        </div>
                    `;
                    
                    e.target.value = '';
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // Auto-response
                    setTimeout(() => {
                        const response = getAdminResponse(message);
                        chatMessages.innerHTML += `
                            <div class="chat-message admin-message">
                                ${response}
                            </div>
                        `;
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 1000);
                }
            });
        }

        function toggleChat() {
            const chatModal = document.getElementById('admin-chat-modal');
            chatModal.classList.toggle('hidden');
            feather.replace();
        }

        function getAdminResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('price') || lowerMessage.includes('cost')) {
                return "Our prices range from ₪100 to ₪1000. Is there a specific product you're interested in?";
            } else if (lowerMessage.includes('delivery') || lowerMessage.includes('shipping')) {
                return "We offer free shipping on all orders. Delivery typically takes 3-5 business days.";
            } else if (lowerMessage.includes('return') || lowerMessage.includes('refund')) {
                return "We have a 30-day return policy. If you're not satisfied with your purchase, you can return it for a full refund.";
            } else if (lowerMessage.includes('contact') || lowerMessage.includes('email')) {
                return "You can reach us at bezalelganam95@gmail.com or through our contact form.";
            } else {
                return "Thank you for your message. Our team will get back to you shortly with more information.";
            }
        }
    </script>
</body>
</html>
